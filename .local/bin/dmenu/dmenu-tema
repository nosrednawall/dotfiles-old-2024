#!/bin/bash

solarized_dark=" Solarized Dark"
solarized_light=" Solarized Light"

# Variable passed to dmenu
options="$solarized_dark\n$solarized_light"

chosen="$(echo -e "$options" | dmenu -p "Tema menu " )"
case $chosen in
    $solarized_dark)
    # Arquivo variavel
    	sed -i 's|^export THEME_MODE=.*|export THEME_MODE="Solarized"|' ~/.dotfiles/.theme_selected
        sed -i 's|^export COLOR_MODE=.*|export COLOR_MODE="Dark"|' ~/.dotfiles/.theme_selected

    # Altero as configuracoes do gtk
    	sed -i 's/^gtk-theme-name=.*/gtk-theme-name=NumixSolarizedDarkCyan/' ~/.dotfiles/.config/gtk-3.0/settings.ini
        sed -i 's/^gtk-icon-theme-name=.*/gtk-icon-theme-name= Numix-Circle/' ~/.dotfiles/.config/gtk-3.0/settings.ini

    # Suckless
        sed -i 's|^#include "themes/.*|#include "themes/solarized_dark.h"|' ~/.dotfiles/.config/suckless/dwm/config.def.h
        sed -i 's|^#include "themes/.*|#include "themes/solarized_dark.h"|' ~/.dotfiles/.config/suckless/st/config.def.h
        sed -i 's|^#include "themes/.*|#include "themes/solarized_dark.h"|' ~/.dotfiles/.config/suckless/dmenu/config.def.h

    # Emacs Doom
        sed -i 's|(setq doom-theme .*)|(setq doom-theme '"'"'doom-solarized-dark)|' ~/.dotfiles/.config/doom/config.el
	;;
    $solarized_light)
    # Arquivo variavel
    	sed -i 's|^export THEME_MODE=.*|export THEME_MODE="Solarized"|' ~/.dotfiles/.theme_selected
        sed -i 's|^export COLOR_MODE=.*|export COLOR_MODE="Light"|' ~/.dotfiles/.theme_selected

    # Altero as configuraçoes do gtk
		sed -i 's/^gtk-theme-name=.*/gtk-theme-name=NumixSolarizedLightCyan/' ~/.dotfiles/.config/gtk-3.0/settings.ini
        sed -i 's/^gtk-icon-theme-name=.*/gtk-icon-theme-name=Numix-Circle-Light/' ~/.dotfiles/.config/gtk-3.0/settings.ini

    # Suckless
        sed -i 's|^#include "themes/.*|#include "themes/solarized_light.h"|' ~/.dotfiles/.config/suckless/dwm/config.def.h
        sed -i 's|^#include "themes/.*|#include "themes/solarized_light.h"|' ~/.dotfiles/.config/suckless/st/config.def.h
        sed -i 's|^#include "themes/.*|#include "themes/solarized_light.h"|' ~/.dotfiles/.config/suckless/dmenu/config.def.h

    # Emacs Doom
        sed -i 's|(setq doom-theme .*)|(setq doom-theme '"'"'doom-solarized-light)|' ~/.dotfiles/.config/doom/config.el
	;;
esac

# Abre o dunst com o tema certo
source $HOME/.dotfiles/.theme_selected
killall dunst
dunst -conf "$HOME/.dotfiles/.config/dunst/themes/${THEME_MODE}_${COLOR_MODE}" &
dunstify "Aplicando tema" "Aguarde..." -h int:value:10  -i /usr/share/icons/ePapirus/16x16/status/package-reinstall.svg

# Compila dwm
cd $HOME/.dotfiles/.config/suckless/dwm
rm config.h
make
SUDO_ASKPASS=/usr/bin/ssh-askpass sudo make clean install

dunstify "Aplicando tema" "Aguarde..." -h int:value:40 -i /usr/share/icons/ePapirus/16x16/status/package-reinstall.svg

# Compila st
cd $HOME/.dotfiles/.config/suckless/st
rm config.h
make
SUDO_ASKPASS=/usr/bin/ssh-askpass sudo make clean install

dunstify "Aplicando tema" "Aguarde..." -h int:value:60 -i /usr/share/icons/ePapirus/16x16/status/package-reinstall.svg

# Compila dmenu
cd $HOME/.dotfiles/.config/suckless/dmenu
rm config.h
make
SUDO_ASKPASS=/usr/bin/ssh-askpass sudo make clean install

dunstify "Aplicando tema" "Aguarde..." -h int:value:80 -i /usr/share/icons/ePapirus/16x16/status/package-reinstall.svg

# Faz sincronizacao do doom
$HOME/.config/emacs/bin/doom sync

dunstify "Aplicando tema" "Aguarde..." -h int:value:99 -i /usr/share/icons/ePapirus/16x16/status/package-reinstall.svg

# Restart dwm
xdotool key Super_L+shift+r

dunstify "Pronto" "Aplicação do tema finalizado!!!" -h int:value:100 -i /usr/share/icons/ePapirus/16x16/status/package-install.svg
exit
